<html>
  <head>
    <script src="https://kit.fontawesome.com/d11171fafd.js" crossorigin="anonymous"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <style>
    .team1 {
      background-color: grey;
    }
    .team2 {
      background-color: grey;
    }
    .weirdinput {
      background: transparent;
      border: none;
    }
    .weirdinput:focus,
    .weirdinput:active {
      background: transparent;
      border: none;
    }
    .bigscore{
      font-size: 350%;
    }
    .time-input-a{
      min-width: 90px;
      text-align: right;
    }
    .time-input-b{
      min-width: 90px;
      text-align: left;
    }
  </style>
  <body>
    <br>
    <div class="container text-center">
        <div class="card-body">
          <div class="btn-group" role="group">
            <button onclick="resetFouls();" class="btn btn-dark">Reset Fouls</button>
            <button onclick="resetScores();" class="btn btn-warning">Reset Scores</button>
          </div>
        </div>
      </div>
    <br>
    <div class="container text-center">
      <div class="row">
        <div class="col">
          <div id="homecard" class="card">
            <br>
            <h3 id="home-namecard">Home</h3>
            <h1 class="bigscore" id="home-scorecard">00</h1>
            <div class="container">
              <div class="btn-group" role="group">
                <button class="btn btn-secondary" onclick="changeValue('home',-1);">-1</button>
                <button class="btn btn-primary" onclick="changeValue('home',1);">+1</button>
                <button class="btn btn-primary" onclick="changeValue('home',2);">+2</button>
                <button class="btn btn-primary" onclick="changeValue('home',3);">+3</button>
              </div>
              <div class="row">
                <br>
              </div>
              <div class="btn-group" role="group">
                <button onclick="changeValue('home_fouls',-1);" class="btn btn-secondary btn-sm">-1</button>
                <button onclick="setValue('home_fouls',0);" class="btn btn-dark btn-sm"><span>Fouls: </span><span id="homefouls">0</span></button>
                <button onclick="changeValue('home_fouls',1);" class="btn btn-primary btn-sm">+1</button>
              </div>
              <br>
              <br>
              <button id="home_poss" onclick="homePoss();">Home Poss</button>
            </div>
            <br/>
          </div>
        </div>
        <div class="col">
          <div id="awaycard" class="card">
            <br>
            <h3 id="away-namecard">Away</h3>
            <h1 class="bigscore" id="away-scorecard">00</h1>
            <div class="container">
              <div class="btn-group" role="group">
                <button class="btn btn-secondary" onclick="changeValue('away',-1);">-1</button>
                <button class="btn btn-primary" onclick="changeValue('away',1);">+1</button>
                <button class="btn btn-primary" onclick="changeValue('away',2);">+2</button>
                <button class="btn btn-primary" onclick="changeValue('away',3);">+3</button>
              </div>
              <div class="row">
                <br>
              </div>
              <div class="btn-group" role="group">
                <button onclick="changeValue('away_fouls',-1);" class="btn btn-secondary btn-sm">-1</button>
                <button onclick="setValue('away_fouls',0);" class="btn btn-dark btn-sm"><span>Fouls: </span><span id="awayfouls">0</span></button>
                <button onclick="changeValue('away_fouls',1);" class="btn btn-primary btn-sm">+1</button>
              </div>
              <br>
              <br>
              <button id="away_poss" onclick="awayPoss();">Away Poss</button>
            </div>
            <br/>
          </div>
        </div>
      </div>
    </div>
    

    <!-- Modal -->
    <div class="modal fade" id="manualModal" tabindex="-1" aria-labelledby="manualModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="manualModalLabel">Manual Mode</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Home - Away - Period</p>
            <input id="home" onchange="updateValue('home');" type="number" />
            <input id="away" onchange="updateValue('away');" type="number" />
            <input id="per" onchange="updateValue('per');" type="text" />

            <br/>
            <p>Home Fouls - Away Fouls</p>
            <input
              id="home_fouls"
              onchange="updateValue('home_fouls');"
              type="number"
            />
            <input
              id="away_fouls"
              onchange="updateValue('away_fouls');"
              type="number"
            />
            <br/>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <div class="container text-cente">
      <div class="card text-center">
        <div class="card-body">
              <h5 class="card-title">Time</h5>
                <div class="input-group mb-3">
                  <button class="btn btn-success" onclick="startTime()"><i class="fa-solid fa-play" style="color: #ffffff;"></i></button>
                  <button class="btn btn-danger" onclick="stopTime()"><i class="fa-solid fa-stop" style="color: #ffffff;"></i></button>
                  <input id="timea" onchange="updateTimeValue();" class="form-control time-input-a" type="number">
                  <button class="btn btn-dark">:</button>
                  <input id="timeb" onchange="updateTimeValue();" class="form-control time-input-b" type="number">
                  <button class="btn" id="showtime" onclick="showTime()"><i class="fa-regular fa-eye" style="color: #ffffff;"></i></button>
                  <button class="btn" id="hidetime" onclick="hideTime()"><i class="fa-regular fa-eye-slash" style="color: #ffffff;"></i></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container text-center">
      <div class="card text-center">
        <div class="card-body">
              <h5 class="card-title">Period</h5>
                <div class="btn-group" role="group">
                  <button onclick="setValue('per','Pregame');" class="btn btn-warning">Pregame</button>
                  <button onclick="setValue('per','1st');" class="btn btn-primary">1st</button>
                  <button onclick="setValue('per','2nd');" class="btn btn-primary">2nd</button>
                  <button onclick="setValue('per','Half');" class="btn btn-secondary">Half</button>
                  <button onclick="setValue('per','3rd');" class="btn btn-primary">3rd</button>
                  <button onclick="setValue('per','4th');" class="btn btn-primary">4th</button>
                  <button onclick="setValue('per','FINAL');" class="btn btn-warning">FINAL</button>
                </div>
              </div>
            </div>
          </div>
        </div>
  </div>
    </div>
    <div class="container">
      <div class="card text-center">
        <div class="card-body">
        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#manualModal">
          Manual Mode
        </button>
        </div>
      </div>
    </div>
    
    
    <br/>
    
    <h3>Preview:</h3>
    <iframe src="/scorebug" width="100%"></iframe>
    <h3>Styling:</h3>
    <br/>

    <a href="/form-home">Upload Home Image</a>
    <a href="/form-away">Upload Away Image</a>
    <br/>
    <p>Home Name:</p>
    <input id="home_name" onchange="updateValue('home_name');" type="text" />
    <p>Away Name:</p>
    <input id="away_name" onchange="updateValue('away_name');" type="text" />
    <br/>
    <p>Home Color 1</p>
    <input
      id="home_color1"
      onchange="updateValue('home_color1');"
      type="color"
    />
    <p>Home Color 2</p>
    <input
      id="home_color2"
      onchange="updateValue('home_color2');"
      type="color"
    />
    <br/>
    <p>Away Color 1</p>
    <input
      id="away_color1"
      onchange="updateValue('away_color1');"
      type="color"
    />

    <p>Away Color 2</p>
    <input
      id="away_color2"
      onchange="updateValue('away_color2');"
      type="color"
    />

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script>
      var timeout;
      var socket = io();
      var digits = "";
      var localSnap;
      var savedSnap = localSnap;

      function getEpochTime() {
        var d = new Date();
        var epochCalc = Math.round(d.getTime() / 1000);
        return epochCalc;
      }

      function updateSnapshot() {
        socket.emit("new snapshot", localSnap);
      }

      function updateState() {
        stopUpdateTime();
        updateElements();
        updateTime();
      }

      function updateValue(id) {
        let element = document.getElementById(id);
        localSnap[id] = element.value;
        updateSnapshot();
      }

      function changeValue(id,amount) {
        let original = localSnap[id];
        localSnap[id] = original + amount;
        updateSnapshot();
      }

      function setValue(id,value) {
        localSnap[id] = value;
        updateSnapshot();
      }

      function resetFouls() {
        localSnap.home_fouls = 0;
        localSnap.away_fouls = 0;
        updateSnapshot();
      }

      function resetScores() {
        localSnap.home=0;
        localSnap.away=0;
        updateSnapshot();
      }

      function updateTimeValue() {
        let timea = document.getElementById("timea");
        let timeb = document.getElementById("timeb");
        let newtime = parseInt(timea.value) * 60 + parseInt(timeb.value);
        localSnap.time = newtime;
        console.log(newtime);
        updateSnapshot();
      }

      function startTime() {
        let newtime = parseInt(timea.value) * 60 + parseInt(timeb.value);
        let offset = parseInt(getEpochTime()) + newtime;
        localSnap.paused = false;
        localSnap.epoch = offset;
        updateSnapshot();
      }

      function stopTime() {
        localSnap.paused = true;
        localSnap.time = parseInt(timea.value) * 60 + parseInt(timeb.value);
        updateSnapshot();
      }

      function updateElements() {
        document.getElementById("home").value = localSnap.home;
        document.getElementById("away").value = localSnap.away;
        document.getElementById("per").value = localSnap.per;
        document.getElementById("home_fouls").value = localSnap.home_fouls;
        document.getElementById("away_fouls").value = localSnap.away_fouls;
        document.getElementById("home_poss").className =
          localSnap.home_poss === true
            ? "btn btn-primary"
            : "btn btn-secondary";
        document.getElementById("away_poss").className =
          localSnap.away_poss === true
            ? "btn btn-primary"
            : "btn btn-secondary";
        document.getElementById("showtime").className =
          localSnap.show_timer === true
            ? "btn btn-primary"
            : "btn btn-secondary";
        document.getElementById("hidetime").className =
          localSnap.show_timer === false
            ? "btn btn-primary"
            : "btn btn-secondary";
        document.getElementById("home_color1").value = localSnap.home_color1;
        document.getElementById("home_color2").value = localSnap.home_color2;
        document.getElementById("away_color1").value = localSnap.away_color1;
        document.getElementById("away_color2").value = localSnap.away_color2;
        document.getElementById("home_name").value = localSnap.home_name;
        document.getElementById("away_name").value = localSnap.away_name;
        document.getElementById("home-namecard").innerHTML = localSnap.home_name;
        document.getElementById("home-scorecard").innerHTML = localSnap.home;
        document.getElementById("away-namecard").innerHTML = localSnap.away_name;
        document.getElementById("away-scorecard").innerHTML = localSnap.away;
        document.getElementById("homecard").style = "background-color: " + localSnap.home_color1 + "; color: " + localSnap.home_color2 + ";";
        document.getElementById("awaycard").style = "background-color: " + localSnap.away_color1 + "; color: " + localSnap.away_color2 + ";";
        document.getElementById("homefouls").innerHTML = localSnap.home_fouls;
        document.getElementById("awayfouls").innerHTML = localSnap.away_fouls;
      }
      function homePoss() {
        localSnap.home_poss = localSnap.home_poss ? false : true;
        localSnap.away_poss = false;
        updateSnapshot();
      }
      function awayPoss() {
        localSnap.away_poss = localSnap.away_poss ? false : true;
        localSnap.home_poss = false;
        updateSnapshot();
      }
      function showTime() {
        localSnap.show_timer = true;
        updateSnapshot();
      }
      function hideTime() {
        localSnap.show_timer = false;
        updateSnapshot();
      }
      socket.on("new snapshot", function (snapshot) {
        localSnap = snapshot;
        savedSnap = localSnap;
        console.log("New Snapshot!");
        console.log(snapshot);
        updateState();
      });
      updateTime();

      function updateTime() {
        if (localSnap.paused == true) {
          time = localSnap.time;
        } else {
          time = Math.abs(localSnap.epoch - getEpochTime());
          timeout = setTimeout(updateTime, 1000);
        }

        seconds = ((time % 60).toString().length == 1) * "0" + (time % 60);
        minutes = Math.floor(time / 60);
        digits = minutes + ":" + seconds;
        document.getElementById("timea").value = Math.floor(time / 60);
        document.getElementById("timeb").value = time % 60;
        console.log(digits);
        console.log(timeout);
      }

      function stopUpdateTime() {
        clearTimeout(timeout);
      }
    </script>
  </body>
</html>
